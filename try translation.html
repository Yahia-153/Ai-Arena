<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Page Translation with LibreTranslate</title>
    <style>
        .loading {
            opacity: 0.5;
            pointer-events: none;
        }
        .loading::after {
            content: "Translating...";
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <h1>Welcome to My Website</h1>
    <p>This is an example of translating an entire page.</p>
    <select id="langSelect">
        <option value="ar">Arabic</option>
        <option value="es">Spanish</option>
        <option value="fr">French</option>
        <option value="de">German</option>
    </select>
    <button onclick="translatePage()">Translate</button>

    <script>
        async function translatePage() {
            const targetLang = document.getElementById('langSelect').value;
            document.body.classList.add('loading');

            // Create TreeWalker to find all text nodes
            const walker = document.createTreeWalker(
                document.body,
                NodeFilter.SHOW_TEXT,
                {
                    acceptNode: function(node) {
                        // Skip script and style tags
                        if (node.parentNode.tagName === 'SCRIPT' || 
                            node.parentNode.tagName === 'STYLE') {
                            return NodeFilter.FILTER_REJECT;
                        }
                        // Only accept nodes with non-empty text
                        return node.textContent.trim() ? 
                            NodeFilter.FILTER_ACCEPT : 
                            NodeFilter.FILTER_SKIP;
                    }
                }
            );

            let node;
            while (node = walker.nextNode()) {
                const text = node.textContent.trim();
                try {
                    const response = await fetch(
                        `https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${targetLang}&dt=t&q=${encodeURIComponent(text)}`
                    );
                    const data = await response.json();
                    if (data && data[0] && data[0][0]) {
                        node.textContent = data[0][0][0];
                    }
                } catch (error) {
                    console.error('Translation failed:', error);
                }
                // Rate limiting
                await new Promise(resolve => setTimeout(resolve, 300));
            }
            
            document.body.classList.remove('loading');
        }
    </script>
</body>
</html>